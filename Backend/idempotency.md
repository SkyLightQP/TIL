# 멱등성 (Idempotency)

멱등성은 동일한 연산을 여러번 해도 결과가 다르지 않음을 보장하는 성질입니다.

계좌 이체, 결제와 같은 거래로 대표적인 예시를 들 수 있습니다.
클라이언트가 계좌 이체 API를 사용하여 서버에 요청할 때 고유한 ID를 함께 보냅니다. 서버는 고유한 ID를 가지고 해당 요청이 이미 처리됐는지 안됐는지 판단합니다. 네트워크 지연 문제 등으로 여러번 계좌 이체 API를 보냈다면 고유한 ID 덕분에 서버는 중복되는 요청을 처리하지 않습니다.

멱등성이 없다면 클라이언트가 10번의 중복 계좌 이체를 요청하면 서버는 그대로 10번의 계좌 이체를 수행하게 되고
이를 막기 위해 계좌 이체를 확인하는 추가 과정이 필요합니다.

REST API를 설계할 때 멱등성 있다고 간주되는 Method가 있습니다.

- GET : 항상 같은 결과를 가져옵니다.
- PUT : 항상 같은 데이터로 덮어씌웁니다.
- DELETE : 항상 리소스를 삭제합니다.
- HEAD, OPTIONS, TRACE

위 예시에서 언급한 것처럼 멱등성을 지키기 위해 아래처럼 구현할 수 있습니다.

1. 고유한 ID를 헤더 등에 담아 서버에 전달하고
2. 서버는 ID와 함께 API 결과를 저장합니다.
3. 동일한 요청(= 동일한 ID)이 들어온다면 기존 API 결과를 클라이언트로 전달합니다.

데이터베이스에서 API 결과를 관리할 수도 있고, Redis, Lock 등을 사용할 수 있습니다.

멱등성을 관리하기 위한 저장소로 Redis를 사용한다면 TTL을 기능을 사용해 API 결과의 유효기간을 정할 수도 있습니다.
